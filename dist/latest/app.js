"use strict";class se{constructor(o,i,t){this.initData=o,this.baseUrl=i,this.manifest=t}initializeWorkspace(){}getUrl(o){return`${this.baseUrl}/${o}`}getMouseCoords(){return this.initData.api.getMouseCoords()}getSelectedBlocks(o){return this.initData.api.getSelectedBlocks(o)}showContextMenuWithBack(o){return this.initData.api.showContextMenuWithBack(o)}registerMenu(o){return this.initData.api.registerMenu(o)}registerItem(o){return this.initData.api.registerItem(o)}createMenu(o,i,t){return this.initData.api.createMenu(o,i,t)}getExtensionVersion(){return this.initData.version}}const Y=new Map;let J;function le(e){J=e,e.pluginManager&&ce(e.pluginManager)}function ce(e){q({baseUrl:e.baseUrl,manifest:{id:"plugin-manager",loadAsModule:e.loadAsModule||!1,main:e.main}})}function q(e){var o;try{const i=new se(J,e.baseUrl,e.manifest);Y.set(e.manifest.id,i);const t=document.createElement("script");t.setAttribute("type",e.manifest.loadAsModule?"module":"text/javascript"),t.setAttribute("src",i.getUrl(e.manifest.main)),t.addEventListener("load",function(){i.initializeWorkspace()}),document.body.appendChild(t)}catch(i){BF2042Portal.Shared.logError(`Failed to load plugin '${((o=e.manifest)==null?void 0:o.name)||e.manifest.id}''`,i)}}function ue(){for(const e of Y.values())e.initializeWorkspace()}function pe(e){const o=Y.get(e);if(!o)throw`Plugin with id ${e} not found!`;return o}const de={initializeWorkspace:ue,getPlugin:pe,loadPlugin:q};function ge(e,o){const i={};return i.Events=e.Events,i.getMainWorkspace=function(){return e.getMainWorkspace()},i.getTranslation=function(t){const n=t.split(".");let r=o.Msg.Msg[n[0]];for(let s=1;s<n.length;s++)r=r[n[s]];return r},i.Blocks={getSelected:function(){return e.getSelected()},getAllClasses:function(){return Object.keys(e.Blocks).map(t=>({key:t,value:e.Blocks[t]}))},getAllInstances:function(){return i.getMainWorkspace().getAllBlocks(!1).map(t=>({key:t.id,value:t}))}},i.ContextMenu={ScopeType:{BLOCK:e.ContextMenuRegistry.ScopeType.BLOCK,WORKSPACE:e.ContextMenuRegistry.ScopeType.WORKSPACE},show:function(t,n,r){e.ContextMenu.show(t,n,r)},getOptionsForWorkspace:function(t){return e.ContextMenuRegistry.registry.getContextMenuOptions(i.ContextMenu.ScopeType.WORKSPACE,{workspace:t})},getOptionsForBlock:function(t){return e.ContextMenuRegistry.registry.getContextMenuOptions(i.ContextMenu.ScopeType.BLOCK,{block:t})},getAllItems:function(){return[...e.ContextMenuRegistry.registry.registry_].map(t=>({key:t[0],value:t[1]}))},unregisterItem:function(t){e.ContextMenuRegistry.registry.unregister(t)},registerItem:function(t){e.ContextMenuRegistry.registry.register(t)}},i.Xml={createElement:e.utils.xml.createElement,mouseToSvg:e.browserEvents.mouseToSvg,workspaceToDom:e.Xml.workspaceToDom,textToDom:e.Xml.textToDom,domToWorkspace:e.Xml.domToWorkspace,domToVariables:e.Xml.domToVariables,domToText:e.Xml.domToText,blockToXml:function(t){const n=e.Xml.blockToDomWithXY(t,!0);return e.Xml.deleteNext(n),e.Xml.domToText(n).replace('xmlns="https://developers.google.com/blockly/xml"',"")}},i}const a=ge(_Blockly,Blockly),F={menus:{},items:{}},w={x:0,y:0},W=[];let v;const b=[],U=[],M=[];let K=!1;const P=new Map;function me(){const e="Failed to copy to clipboard!";function o(){return"enabled"}async function i(t){try{const n=k(t),r=Z(n);if(!r){alert(e);return}await BF2042Portal.Shared.copyTextToClipboard(r)}catch(n){BF2042Portal.Shared.logError(e,n),alert(e)}}return{id:"copyToClipboard",displayText:"Copy to Clipboard",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:o,callback:i}}function fe(){const e="Failed to paste from clipboard!";function o(){return"enabled"}async function i(){try{const t=await BF2042Portal.Shared.pasteTextFromClipboard();ee(t)||alert(e)}catch(t){BF2042Portal.Shared.logError(e,t),alert(e)}}return{id:"pasteFromClipboard",displayText:"Paste from Clipboard",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:o,callback:i}}function ye(){function e(t){const n=t.block.getCommentIcon()?"Remove":"Add",r=k(t);return r.length===1?`${n} Comment`:`${n} Comment (${r.length} Blocks)`}function o(){return"enabled"}function i(t){const n=t.block.getCommentIcon()?null:"",r=k(t);for(let s=0;s<r.length;s++)r[s].setCommentText(n)}return{id:"toggleComments",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:o,callback:i}}function he(){function e(t){const n=t.block.getInputsInline()?"Vertically":"Horizontally",r=k(t);return r.length===1?`Show Inputs ${n}`:`Show Inputs ${n} (${r.length} Blocks)`}function o(){return"enabled"}function i(t){const n=!t.block.getInputsInline(),r=k(t);for(let s=0;s<r.length;s++)r[s].setInputsInline(n)}return{id:"toggleInputs",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:o,callback:i}}function ke(){function e(t){const n=t.block.isCollapsed()?"Expand":"Collapse",r=k(t);return r.length===1?`${n} Block`:`${n} ${r.length} Blocks`}function o(){return"enabled"}function i(t){const n=!t.block.isCollapsed(),r=k(t);for(let s=0;s<r.length;s++)r[s].setCollapsed(n)}return{id:"toggleCollapse",displayText:e,scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:o,callback:i}}function xe(){function e(t){const n=k(t);return n?n.length===1?"Collapse Block":`Collapse ${n.length} Blocks`:"Collapse All Blocks"}function o(){return"enabled"}function i(t){const n=k(t);if(n)for(let r=0;r<n.length;r++)n[r].setCollapsed(!0);else{const r=a.getMainWorkspace();for(const s of r.getAllBlocks(!1))s.setCollapsed(!0)}}return{id:"collapseAllBlocks",displayText:e,scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:o,callback:i}}function be(){function e(t){const n=k(t);return n?n.length===1?"Expand Block":`Expand ${n.length} Blocks`:"Expand All Blocks"}function o(){return"enabled"}function i(t){const n=k(t);if(n)for(let r=0;r<n.length;r++)n[r].setCollapsed(!1);else{const r=a.getMainWorkspace();for(const s of r.getAllBlocks(!1))s.setCollapsed(!1)}}return{id:"expandAllBlocks",displayText:e,scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:o,callback:i}}function Te(){function e(i){return i.block.type==="modBlock"&&a.getMainWorkspace().getBlocksByType("modBlock",!1).length>1?"enabled":"hidden"}function o(i){i.block.dispose(!1,!1)}return{id:"deleteModBlock",displayText:"Delete Mod Block",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:e,callback:o}}function Ce(){const e="https://docs.bfportal.gg/blocks";function o(){return"enabled"}function i(){window.open(e,"bf2042_documentation")}return{id:"openDocumentation",displayText:"Open Documentation",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:o,callback:i}}function Be(){function e(i){return i.block.type==="subroutineInstanceBlock"?"enabled":"hidden"}function o(i){const t=i.block.getFieldValue("SUBROUTINE_NAME"),n=a.getMainWorkspace().getBlocksByType("subroutineBlock",!1).filter(r=>r.getFieldValue("SUBROUTINE_NAME")===t);n.length>0&&a.getMainWorkspace().centerOnBlock(n[0].id)}return{id:"jumpToSubRoutine",displayText:"Jump to Subroutine",scopeType:a.ContextMenu.ScopeType.BLOCK,weight:100,preconditionFn:e,callback:o}}function Se(){function e(){return"enabled"}function o(){document.querySelector("app-root").classList.toggle("distraction-free"),a.getMainWorkspace().resize()}return{id:"toggleDistractionFreeMode",displayText:"Toggle Distraction-Free Mode",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:o}}function Me(){function e(){return"enabled"}function o(){document.querySelector("app-root").classList.toggle("hide-toolbox"),a.getMainWorkspace().resize()}return{id:"toggleToolbox",displayText:"Toggle Toolbox",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:o}}function we(){return H("exportBlocksWorkspace",a.ContextMenu.ScopeType.WORKSPACE)}function Ee(){return H("exportBlocksBlock",a.ContextMenu.ScopeType.BLOCK)}function H(e,o){function i(){return"enabled"}function t(l){const d=[{text:"XML",enabled:!0,callback:()=>n(l)},{text:"SVG",enabled:!0,callback:()=>r(l)},{text:"PNG",enabled:!0,callback:()=>s(l)}];BF2042Portal.Shared.isCopyBlobToClipboardSupported()&&d.push({text:"PNG (Clipboard)",enabled:!0,callback:()=>m(l)}),L(d)}async function n(l){const d=k(l),p=Z(d);if(!p){alert("Failed to export XML!");return}const C=`data:application/xml;charset=utf-8,${encodeURIComponent(p)}`;y(C,"workspace.xml")}async function r(l){const d=k(l),p=await u(d,!1);y(p.svgDataURL,"screenshot.svg")}async function s(l){try{const d=k(l),p=await u(d,!0),C=await c(p,1,"png");y(C,"screenshot.png")}catch(d){BF2042Portal.Shared.logError("Failed to export PNG (Download)",d),alert("Failed to export PNG (Download)!")}}async function m(l){try{const d=k(l),p=await u(d,!0),C=await c(p,1,"blob");await BF2042Portal.Shared.copyBlobToClipboard(C),alert("Done!")}catch(d){BF2042Portal.Shared.logError("Failed to export PNG (Clipboard)",d),alert("Failed to export PNG (Clipboard)!")}}async function u(l,d){const p=a.getMainWorkspace();let C,A,E,x;if(l&&l.length>0){let f,B,T,I;for(let R=0;R<l.length;R++){const N=l[R],S=N.getRelativeToSurfaceXY();(!f||S.x<f)&&(f=S.x),(!B||S.y<B)&&(B=S.y),(!T||S.x+N.width>T)&&(T=S.x+N.width),(!I||S.y+N.height>I)&&(I=S.y+N.height)}C=f,A=B,E=T-f,x=I-B}else{const f=p.getBlocksBoundingBox();C=f.left,A=f.top,E=f.right-C,x=f.bottom-A}const O=p.getCanvas().cloneNode(!0);O.removeAttribute("transform");const h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.appendChild(O),h.setAttribute("viewBox",`${C} ${A} ${E} ${x}`),h.setAttribute("class",`blocklySvg ${p.options.renderer||"geras"}-renderer ${p.getTheme?p.getTheme().name+"-theme":""}`),h.setAttribute("width",E.toString()),h.setAttribute("height",x.toString()),h.setAttribute("style","background-color: transparent");const ne=[].slice.call(document.head.querySelectorAll("style")).filter(function(f){return/\.blocklySvg/.test(f.innerText)||f.id.indexOf("blockly-")===0}).map(function(f){return f.innerText}).join(""),z=document.createElement("style");z.innerHTML=ne,h.insertBefore(z,h.firstChild);let D=new XMLSerializer().serializeToString(h).replace(/&nbsp/g,"&#160");if(d){const f=[...D.matchAll(/xlink:href="(.*?)"/g)];for(const B of f){const T=B[1];if(!(T.startsWith("data:")||P.has(T)))try{const I=await new Promise(async(R,N)=>{try{const re=await(await fetch("https://portal.battlefield.com"+T)).blob(),G=new FileReader;G.onload=ae=>{R(ae.target.result)},G.readAsDataURL(re)}catch{N()}});P.set(T,I)}catch{P.set(T,T)}}}D=D.replace(/xlink:href="(.*?)"/g,function(f,B){return`xlink:href="${P.has(B)?P.get(B):B}"`});const ie=`data:image/svg+xml,${encodeURIComponent(D)}`;return{width:E,height:x,svgDataURL:ie}}async function c(l,d,p){return new Promise((A,E)=>{const x=document.createElement("canvas"),j=x.getContext("2d"),O=new Image;x.width=l.width*d,x.height=l.height*d,(x.width>16384||x.height>16384)&&E("The resulting image would be too large to handle for your browser. Please select less blocks or reduce the scale."),O.onload=function(){j.drawImage(O,0,0,l.width,l.height,0,0,x.width,x.height);try{if(p==="png"){const h=x.toDataURL("image/png");A(h)}else if(p==="blob")x.toBlob(function(h){A(h)});else throw"Unknown type"}catch(h){E(`Failed to convert SVG: ${h}`)}},O.src=l.svgDataURL})}function y(l,d){const p=document.createElement("a");p.setAttribute("href",l),p.setAttribute("download",d),p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p)}return{id:e,displayText:"Export Blocks >",scopeType:o,weight:100,preconditionFn:i,callback:t}}function ve(){function e(){return"enabled"}function o(){const i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("accept",".xml,.json"),i.style.display="none",i.addEventListener("change",function(){if(!i.files||i.files.length===0)return;const t=new FileReader;t.onload=function(n){confirm("Do you want to remove all existing blocks before importing?")&&a.getMainWorkspace().clear();try{const r=i.files[0].name.split(".").pop().toLowerCase();if(r==="json"){const s=JSON.parse(n.target.result);Pe(s)||alert("Failed to import workspace from JSON!")}else r==="xml"&&(ee(n.target.result)||alert("Failed to import workspace from XML!"))}catch{alert("Failed to import workspace!")}},t.readAsText(i.files[0])}),document.body.appendChild(i),i.click(),document.body.removeChild(i)}return{id:"importBlocksFromFile",displayText:"Import Blocks from File",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:o}}function Ae(){function e(){return"enabled"}function o(){const t=[];for(let n=0;n<U.length;n++){const r=U[n];t.push({text:r.displayName,enabled:!0,callback:function(){const s=[];for(let m=0;m<r.contents.length;m++){const u=r.contents[m];let c;switch(u.type){case"mod":c="⚫";break;case"rule":case"controlAction":c="🟣";break;case"condition":c="🔵";break;case"value":case"literal":c="🟢";break;case"action":c="🟡";break;default:c="⚪";break}s.push({text:`${c} ${u.displayName}`,enabled:!0,callback:function(){const y=a.getMainWorkspace().newBlock(u.internalName);y.initSvg(),y.render(),y.moveTo(w)}})}L(s.sort(i))}})}L(t.sort(i))}function i(t,n){return t.text>n.text?1:-1}return{id:"addBlock",displayText:"Add Block >",scopeType:a.ContextMenu.ScopeType.WORKSPACE,weight:100,preconditionFn:e,callback:o}}function Ie(){return Q("separatorWorkspace",a.ContextMenu.ScopeType.WORKSPACE)}function Ne(){return Q("separatorBlock",a.ContextMenu.ScopeType.BLOCK)}function Q(e,o){return{id:e,displayText:"---",scopeType:o,weight:100,preconditionFn:()=>"disabled",callback:()=>{}}}function Fe(){return V("optionsWorkspace","Options",a.ContextMenu.ScopeType.WORKSPACE)}function Oe(){return V("optionsBlock","Options",a.ContextMenu.ScopeType.BLOCK)}function V(e,o,i){function t(){return"enabled"}function n(r){const s=F.menus[e],m=[];for(let u=0;u<s.options.length;u++){const c=Re(s.options[u],i,r);c&&m.push(c)}L(m)}return{id:e,displayText:`${o} >`,scopeType:i,weight:100,preconditionFn:t,callback:n,options:[]}}function Re(e,o,i){let t;if(e.startsWith("items.")?t=F.items[e.substring(6)]:e.startsWith("menus.")&&(t=F.menus[e.substring(6)]),!(!t||t.scopeType!==o))return{text:typeof t.displayText=="string"?t.displayText:t.displayText(i),enabled:t.preconditionFn(i)==="enabled",callback:()=>t.callback(i)}}function $(e){F.menus[e.id]=e}function g(e){F.items[e.id]=e}function Z(e){const o=a.getMainWorkspace();try{let i="";if(e&&e.length>0){for(let t=0;t<e.length;t++)i+=a.Xml.blockToXml(e[t]);return i}else{const t=a.Xml.workspaceToDom(o,!0),n=t.querySelector("variables");return n&&t.removeChild(n),a.Xml.domToText(t).replace('<xml xmlns="https://developers.google.com/blockly/xml">',"").replace("</xml>","")}}catch(i){BF2042Portal.Shared.logError("Failed to save workspace!",i)}}function Pe(e){const o=a.getMainWorkspace();try{const i=a.Xml.textToDom(e.variables?e.variables:"<xml />");return a.Xml.domToVariables(i,o),a.Xml.domToWorkspace(a.Xml.textToDom(e.mainWorkspace),o),!0}catch(i){BF2042Portal.Shared.logError("Failed to load workspace from JSON!",i)}return!1}function ee(e){try{if(!e||(e=e.trim(),!e.startsWith("<block")))return!1;const o=`<xml xmlns="https://developers.google.com/blockly/xml">${e.trim()}</xml>`,i=a.Xml.textToDom(o),t=i.querySelectorAll("block[type='variableReferenceBlock']"),n=[];t.forEach(u=>{const c=u.querySelector("field[name='OBJECTTYPE']").textContent,y=u.querySelector("field[name='VAR']").textContent;c&&y&&!n.find(l=>l.objectType===c&&l.variableName===y)&&n.push({objectType:c,variableName:y})});const r=document.createElement("variables");n.forEach(u=>{const c=document.createElement("variable");c.setAttribute("type",u.objectType),c.innerText=u.variableName,r.appendChild(c)}),a.Xml.domToVariables(r,a.getMainWorkspace());let s,m;for(let u=0;u<i.childNodes.length;u++){const c=i.childNodes[u],y=parseInt(c.getAttribute("x")),l=parseInt(c.getAttribute("y"));(!s||y<s)&&(s=y),(!m||l<m)&&(m=l)}for(let u=0;u<i.childNodes.length;u++){const c=i.childNodes[u],y=parseInt(c.getAttribute("x")),l=parseInt(c.getAttribute("y"));y===s?c.setAttribute("x",w.x.toString()):c.setAttribute("x",(y-s+w.x).toString()),l===m?c.setAttribute("y",w.y.toString()):c.setAttribute("y",(l-m+w.y).toString())}return a.Xml.domToWorkspace(i,a.getMainWorkspace()),!0}catch(o){BF2042Portal.Shared.logError("Failed to load workspace from XML!",o)}return!1}function X(e){return e.split(" ").map(o=>o.charAt(0).toUpperCase()+o.substring(1).toLowerCase()).join(" ")}function k(e){let o;return M.length>0&&(o=M),!o&&(a.Blocks.getSelected()||e!==void 0&&e.block)&&(o=[a.Blocks.getSelected()||e.block]),o}function We(){return{x:w.x,y:w.y}}function L(e){W.push(v.options),a.ContextMenu.show(v.e,[].concat({text:"< Back",enabled:!0,callback:()=>{const o=W.splice(W.length-1,1);a.ContextMenu.show(v.e,o[0],v.rtl)}},{text:"---",enabled:!1,callback:()=>{}}).concat(e),v.rtl)}function Le(){De(),Xe(),Ue(),$e(BF2042Portal.Startup.getBlockDefinitions()),_e(),Ke(),le({api:{getSelectedBlocks:k,getMouseCoords:We,showContextMenuWithBack:L,registerMenu:$,registerItem:g,createMenu:V},version:BF2042Portal.Startup.getVersion(),pluginManager:BF2042Portal.Startup.getManifest().pluginManager})}function De(){const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=`
        /*.blocklyMenu {
            overflow-y: hidden !important;
        }*/

        .distraction-free ea-network-nav, .distraction-free ea-local-nav-advanced {
            display: none;
        }

        .distraction-free > div.app {
            padding-top: 0;
        }

        .distraction-free .editor-container {
            grid-template-columns: 0 !important;
        }

        .hide-toolbox .blocklyToolboxDiv {
            display: none !important;
        }
    `,document.head.appendChild(e)}function Xe(){const e=a.getMainWorkspace(),o=Object.getPrototypeOf(e),i=o.showContextMenu;o.showContextMenu=function(s){W.length=0,v={e:s,options:a.ContextMenu.getOptionsForWorkspace(this),rtl:this.RTL},_(s),i.apply(this,arguments)};const t=Object.getPrototypeOf(e.getTopBlocks(!1)[0]),n=t.showContextMenu;t.showContextMenu=function(s){return W.length=0,v={e:s,options:a.ContextMenu.getOptionsForBlock(this),rtl:this.RTL},_(s),n.apply(this,arguments)};const r=_Blockly.ContextMenu.show;_Blockly.ContextMenu.show=function(s,m,u){v={e:s,options:m,rtl:u},_(s),r.apply(this,arguments)}}function Ue(){function e(i){Ve(),Ye(i),setTimeout(function(){BF2042Portal.Plugins.initializeWorkspace()},0)}const o=_Blockly.inject;_Blockly.inject=function(){const i=o.apply(this,arguments);return e(i),i},e(a.getMainWorkspace())}function _e(){document.addEventListener("keydown",function(e){K=e.shiftKey}),document.addEventListener("keyup",function(e){K=e.shiftKey})}function Ke(){for(const n of a.ContextMenu.getAllItems())g(n.value);a.ContextMenu.unregisterItem("cleanWorkspace"),a.ContextMenu.unregisterItem("workspaceDelete");const e=Fe();e.weight=-99,e.options=["items.workspaceDelete","items.separatorWorkspace","items.collapseAllBlocks","items.expandAllBlocks","items.openDocumentation","items.toggleDistractionFreeMode","items.toggleToolbox","items.separatorWorkspace","items.exportBlocksWorkspace","items.importBlocksFromFile"];const o=Oe();o.weight=-99,o.options=["items.deleteModBlock","items.separatorBlock","items.toggleComments","items.toggleInputs","items.toggleCollapse","items.separatorBlock","items.exportBlocksBlock"],$(e),$(o),g(me()),g(fe()),g(ye()),g(he()),g(ke()),g(xe()),g(be()),g(Te()),g(Ce()),g(Be()),g(Se()),g(Me()),g(we()),g(Ee()),g(ve()),g(Ie()),g(Ne());const i=Ae();i.weight=-100,g(i),["items.addBlock","menus.optionsWorkspace","menus.optionsBlock","items.cleanWorkspace","items.jumpToSubRoutine","items.copyToClipboard","items.pasteFromClipboard"].forEach(function(n){let r;if(n.startsWith("items.")){const s=n.substring(6);r=F.items[s]}else if(n.startsWith("menus.")){const s=n.substring(6);r=F.menus[s]}r&&a.ContextMenu.registerItem(r)})}function $e(e){b.push({type:"mod",category:t("RULES"),internalName:"modBlock",displayName:X(a.getTranslation("PYRITE_MOD"))}),b.push({type:"rule",category:t("RULES"),internalName:"ruleBlock",displayName:X(a.getTranslation("PYRITE_RULE"))}),b.push({type:"condition",category:t("RULES"),internalName:"conditionBlock",displayName:X(a.getTranslation("PYRITE_CONDITION"))}),b.push({type:"literal",category:t("LITERALS"),internalName:"Boolean",displayName:a.getTranslation("PYRITE_TYPE_BOOLEAN")}),b.push({type:"literal",category:t("LITERALS"),internalName:"Number",displayName:a.getTranslation("PYRITE_TYPE_NUMBER")}),b.push({type:"literal",category:t("LITERALS"),internalName:"Text",displayName:a.getTranslation("PYRITE_TYPE_STRING")}),b.push({type:"value",category:t("ARRAYS"),internalName:"ArrayContains",displayName:a.getTranslation("PYRITE_CONVENIENCE_ARRAYCONTAINS")}),b.push({type:"value",category:t("ARRAYS"),internalName:"IndexOfArrayValue",displayName:a.getTranslation("PYRITE_CONVENIENCE_INDEXOFARRAYVALUE")}),b.push({type:"value",category:t("ARRAYS"),internalName:"RemoveFromArray",displayName:a.getTranslation("PYRITE_CONVENIENCE_REMOVEFROMARRAY")}),b.push({type:"value",category:t("SUBROUTINES"),internalName:"subroutineArgumentBlock",displayName:"GetSubroutineArgument"}),b.push({type:"action",category:t("CONVENIENCE"),internalName:"actionComment",displayName:"Comment"});const o=[...new Set(e.selectionLists.map(n=>n.listType+"Item"))],i=["GetArgument"];for(let n=0;n<e.values.length;n++){const r=e.values[n];if(!r.category){if(i.includes(r.name))continue;r.name==="GetVariable"?r.category="VARIABLES":o.includes(r.name)?r.category="SELECTION_LISTS":BF2042Portal.Shared.logError("No category found for value-block",r)}b.push({type:"value",category:t(r.category),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}for(let n=0;n<e.actions.length;n++){const r=e.actions[n];r.category||(r.name==="SetVariable"?r.category="VARIABLES":BF2042Portal.Shared.logError("No category found for action-block",r)),b.push({type:"action",category:t(r.category),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}for(let n=0;n<e.controlActions.length;n++){const r=e.controlActions[n];b.push({type:"controlAction",category:t("CONTROL_ACTIONS"),internalName:r.name,displayName:a.getTranslation(r.displayNameSID)||r.name})}b.forEach(n=>{const r=U.find(s=>s.internalName===(n.category||"Other"));r?r.contents.push(n):U.push({internalName:n.category||"Other",displayName:X(n.category||"Other"),contents:[n]})});function t(n){if(n)return a.getTranslation("PYRITE_TOOLBOX_"+n.replace(" ","_").toUpperCase())}}function Ye(e){let o,i,t;e.addChangeListener(function(n){if(n.type===a.Events.CLICK||n.type===a.Events.SELECTED)if(K){if(!n.blockId)return;const r=e.getBlockById(n.blockId),s=M.indexOf(r);s<0?(M.push(r),r.setHighlighted(!0)):(M.splice(s,1),r.setHighlighted(!1))}else M.length>0&&(M.forEach(r=>{r.setHighlighted(!1)}),M.length=0);else if(n.type===a.Events.BLOCK_DRAG&&!n.isStart)t=n.blockId;else if(n.type===a.Events.MOVE&&n.newCoordinate&&n.oldCoordinate&&t){const r=t;t=void 0,o=n.newCoordinate.x-n.oldCoordinate.x,i=n.newCoordinate.y-n.oldCoordinate.y;for(let s=0;s<M.length;s++){const m=M[s];m.id!==r&&m.moveBy(o,i)}}})}function _(e){const o=a.getMainWorkspace();if(!o)return;const i=a.Xml.mouseToSvg(e,o.getParentSvg(),o.getInverseScreenCTM()),t=o.getMetricsManager().getAbsoluteMetrics();i.x-=t.left,i.y-=t.top,i.x-=o.scrollX,i.y-=o.scrollY,i.x/=o.scale,i.y/=o.scale,w.x=i.x,w.y=i.y}function Ve(){function e(o){if(!o.saveExtraState||!o.loadExtraState||o.mutationToDom&&o.domToMutation)return;o.mutationToDom=function(){const t=a.Xml.createElement("mutation");return t.setAttribute("portal-extensions-state",JSON.stringify(this.saveExtraState())),t};const i=o.domToMutation;o.domToMutation=function(t){const n=t.getAttribute("portal-extensions-state");n?this.loadExtraState(JSON.parse(n)):i&&i.apply(this,arguments)}}for(const o of a.Blocks.getAllClasses())e(o.value);for(const o of a.Blocks.getAllInstances())e(o.value)}const je={};let te=He,oe=e=>{};function ze(){navigator.clipboard.readText===void 0&&(te=Qe,window.addEventListener("bf2042-portal-extensions-paste",async function(e){oe(e.detail)}))}async function Ge(e){return await navigator.clipboard.writeText(e)}async function Je(e){return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}async function qe(){return await te()}async function He(){return await navigator.clipboard.readText()}async function Qe(){return new Promise((e,o)=>{oe=t=>{t?e(t):o()};const i=new Event("bf2042-portal-extensions-paste");document.dispatchEvent(i)})}function Ze(){return window.ClipboardItem!==void 0}function et(e,o){console.log(`[ERROR] ${e}`,o)}function tt(e){const o=localStorage.getItem(e);try{if(typeof o=="string")return JSON.parse(o)}catch{}return{}}function ot(e,o){localStorage.setItem(e,JSON.stringify(o))}const nt={copyTextToClipboard:Ge,copyBlobToClipboard:Je,pasteTextFromClipboard:qe,isCopyBlobToClipboardSupported:Ze,loadFromLocalStorage:tt,saveToLocalStorage:ot,logError:et};BF2042Portal.Shared=nt;BF2042Portal.Plugins=de;BF2042Portal.Extensions=je;ze();Le();
//# sourceMappingURL=app.js.map
