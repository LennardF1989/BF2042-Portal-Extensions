{"version":3,"file":"app.js","sources":["../../src/web/Plugins.ts","../../src/web/Extensions.ts","../../src/web/Shared.ts","../../src/web/App.ts"],"sourcesContent":["import { BlockSvg } from \"blockly\";\nimport {\n    MenuOption,\n    MouseCoords,\n    PluginApi,\n    RegistryMenuItem,\n} from \"./Extensions\";\nimport {\n    RegistryItem,\n    Scope,\n    ScopeType,\n} from \"blockly/core/contextmenu_registry\";\n\ninterface BaseManifest {\n    loadAsModule?: boolean;\n    main: string;\n}\n\nexport interface PluginManagerManifest extends BaseManifest {\n    baseUrl: string;\n}\n\ninterface PluginManifest extends BaseManifest {\n    id: string;\n    name?: string;\n    version?: string;\n    description?: string;\n    author?: string;\n}\n\ninterface PluginData {\n    baseUrl: string;\n    manifest: PluginManifest;\n}\n\ninterface InitData {\n    version: string;\n    api: PluginApi;\n    pluginManager?: PluginManagerManifest;\n}\n\nclass BasePlugin {\n    readonly initData: InitData;\n    readonly baseUrl: string;\n    readonly manifest: PluginManifest;\n\n    constructor(initData: InitData, baseUrl: string, manifest: PluginManifest) {\n        this.initData = initData;\n        this.baseUrl = baseUrl;\n        this.manifest = manifest;\n    }\n\n    public initializeWorkspace(): void {\n        //Do nothing\n    }\n\n    public getUrl(relativeUrl: string): string {\n        return `${this.baseUrl}/${relativeUrl}`;\n    }\n\n    public getMouseCoords(): MouseCoords {\n        return this.initData.api.getMouseCoords();\n    }\n\n    public getSelectedBlocks(scope: Scope): Array<BlockSvg> {\n        return this.initData.api.getSelectedBlocks(scope);\n    }\n\n    public showContextMenuWithBack(options: Array<MenuOption>): void {\n        return this.initData.api.showContextMenuWithBack(options);\n    }\n\n    public registerMenu(menu: RegistryMenuItem): void {\n        return this.initData.api.registerMenu(menu);\n    }\n\n    public registerItem(item: RegistryItem): void {\n        return this.initData.api.registerItem(item);\n    }\n\n    public createMenu(\n        id: string,\n        name: string,\n        scopeType: ScopeType,\n    ): RegistryMenuItem {\n        return this.initData.api.createMenu(id, name, scopeType);\n    }\n\n    public getExtensionVersion(): string {\n        return this.initData.version;\n    }\n}\n\nconst plugins: Map<string, BasePlugin> = new Map<string, BasePlugin>();\n\nlet initData: InitData;\n\nexport function init(data: InitData): void {\n    initData = data;\n\n    if (data.pluginManager) {\n        loadPluginManager(data.pluginManager);\n    }\n}\n\nfunction loadPluginManager(pluginManager: PluginManagerManifest): void {\n    loadPlugin({\n        baseUrl: pluginManager.baseUrl,\n        manifest: {\n            id: \"plugin-manager\",\n            loadAsModule: pluginManager.loadAsModule || false,\n            main: pluginManager.main,\n        },\n    });\n}\n\nfunction loadPlugin(pluginData: PluginData): void {\n    try {\n        const plugin: BasePlugin = new BasePlugin(\n            initData,\n            pluginData.baseUrl,\n            pluginData.manifest,\n        );\n        plugins.set(pluginData.manifest.id, plugin);\n\n        const scriptElement: HTMLScriptElement =\n            document.createElement(\"script\");\n        scriptElement.setAttribute(\n            \"type\",\n            pluginData.manifest.loadAsModule ? \"module\" : \"text/javascript\",\n        );\n        scriptElement.setAttribute(\n            \"src\",\n            plugin.getUrl(pluginData.manifest.main),\n        );\n        scriptElement.addEventListener(\"load\", function () {\n            plugin.initializeWorkspace();\n        });\n\n        document.body.appendChild(scriptElement);\n    } catch (e) {\n        BF2042Portal.Shared.logError(\n            `Failed to load plugin '${\n                pluginData.manifest?.name || pluginData.manifest.id\n            }''`,\n            e,\n        );\n    }\n}\n\nfunction initializeWorkspace(): void {\n    for (const plugin of plugins.values()) {\n        plugin.initializeWorkspace();\n    }\n}\n\nfunction getPlugin(id: string): BasePlugin {\n    const plugin: BasePlugin = plugins.get(id);\n\n    if (!plugin) {\n        throw `Plugin with id ${id} not found!`;\n    }\n\n    return plugin;\n}\n\nexport default {\n    initializeWorkspace: initializeWorkspace,\n    getPlugin: getPlugin,\n    loadPlugin: loadPlugin,\n};\n","import { Block, BlockSvg, Events, WorkspaceSvg } from \"blockly\";\nimport {\n    ContextMenuOption,\n    RegistryItem,\n} from \"blockly/core/contextmenu_registry\";\nimport { init as pluginInit } from \"./Plugins\";\nimport { BlockDefinition } from \"blockly/core/blocks\";\nimport { ScopeType } from \"blockly/core/contextmenu_registry\";\nimport { Scope } from \"blockly/core/contextmenu_registry\";\nimport { BlockMove, Click, Selected } from \"blockly/core/events/events\";\nimport { BlockDrag } from \"blockly/core/events/events_block_drag\";\nimport { Coordinate } from \"blockly/core/utils\";\nimport { createElement } from \"blockly/core/utils/xml\";\nimport { mouseToSvg } from \"blockly/core/browser_events\";\nimport {\n    domToText,\n    domToVariables,\n    domToWorkspace,\n    textToDom,\n    workspaceToDom,\n} from \"blockly/core/xml\";\n\ninterface BlocklyWrapper {\n    Events: typeof Events;\n\n    Blocks: {\n        getSelected(): BlockSvg;\n        getAllClasses(): Array<{ key: string; value: BlockDefinition }>;\n        getAllInstances(): Array<{ key: string; value: BlockSvg }>;\n    };\n\n    ContextMenu: {\n        ScopeType: typeof ScopeType;\n\n        show(\n            event: Event,\n            options: Array<ContextMenuOption>,\n            rtl: boolean,\n        ): void;\n        getOptionsForWorkspace(\n            workspace: WorkspaceSvg,\n        ): Array<ContextMenuOption>;\n        getOptionsForBlock(block: BlockSvg): Array<ContextMenuOption>;\n        getAllItems(): Array<{ key: string; value: RegistryItem }>;\n        unregisterItem(item: string): void;\n        registerItem(item: RegistryItem): void;\n    };\n\n    Xml: {\n        createElement: typeof createElement;\n        mouseToSvg: typeof mouseToSvg;\n\n        workspaceToDom: typeof workspaceToDom;\n        textToDom: typeof textToDom;\n\n        domToWorkspace: typeof domToWorkspace;\n        domToVariables: typeof domToVariables;\n        domToText: typeof domToText;\n\n        blockToXml: (block: BlockSvg) => string;\n    };\n\n    getMainWorkspace(): WorkspaceSvg;\n    getTranslation(key: string): string;\n}\n\nfunction blocklyWrapper(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    blockly: any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    blocklyTranslations: any,\n): BlocklyWrapper {\n    const self: BlocklyWrapper = {} as BlocklyWrapper;\n\n    self.Events = blockly.Events;\n\n    self.getMainWorkspace = function (): WorkspaceSvg {\n        return blockly.getMainWorkspace();\n    };\n\n    self.getTranslation = function (key: string): string {\n        const splitKeys = key.split(\".\");\n\n        let firstElement = blocklyTranslations.Msg.Msg[splitKeys[0]];\n\n        for (let index = 1; index < splitKeys.length; index++) {\n            firstElement = firstElement[splitKeys[index]];\n        }\n\n        return firstElement;\n    };\n\n    self.Blocks = {\n        getSelected: function (): BlockSvg {\n            return blockly.getSelected();\n        },\n\n        getAllClasses: function (): Array<{\n            key: string;\n            value: BlockDefinition;\n        }> {\n            return Object.keys(blockly.Blocks).map((e: string) => {\n                return {\n                    key: e,\n                    value: blockly.Blocks[e],\n                };\n            });\n        },\n\n        getAllInstances: function (): Array<{ key: string; value: BlockSvg }> {\n            return self\n                .getMainWorkspace()\n                .getAllBlocks(false)\n                .map((e: BlockSvg) => {\n                    return {\n                        key: e.id,\n                        value: e,\n                    };\n                });\n        },\n    };\n\n    self.ContextMenu = {\n        ScopeType: {\n            BLOCK: blockly.ContextMenuRegistry.ScopeType.BLOCK,\n            WORKSPACE: blockly.ContextMenuRegistry.ScopeType.WORKSPACE,\n        },\n\n        show: function (\n            event: Event,\n            options: Array<ContextMenuOption>,\n            rtl: boolean,\n        ): void {\n            blockly.ContextMenu.show(event, options, rtl);\n        },\n\n        getOptionsForWorkspace: function (\n            workspace: WorkspaceSvg,\n        ): Array<ContextMenuOption> {\n            return blockly.ContextMenuRegistry.registry.getContextMenuOptions(\n                self.ContextMenu.ScopeType.WORKSPACE,\n                {\n                    workspace: workspace,\n                },\n            );\n        },\n\n        getOptionsForBlock: function (\n            block: BlockSvg,\n        ): Array<ContextMenuOption> {\n            return blockly.ContextMenuRegistry.registry.getContextMenuOptions(\n                self.ContextMenu.ScopeType.BLOCK,\n                {\n                    block: block,\n                },\n            );\n        },\n\n        getAllItems: function (): Array<{ key: string; value: RegistryItem }> {\n            return [...blockly.ContextMenuRegistry.registry.registry_].map(\n                (e: { [0]: string; [1]: RegistryItem }) => {\n                    return {\n                        key: e[0],\n                        value: e[1],\n                    };\n                },\n            );\n        },\n\n        unregisterItem: function (item: string): void {\n            blockly.ContextMenuRegistry.registry.unregister(item);\n        },\n\n        registerItem: function (item: RegistryItem): void {\n            blockly.ContextMenuRegistry.registry.register(item);\n        },\n    };\n\n    self.Xml = {\n        createElement: blockly.utils.xml.createElement,\n        mouseToSvg: blockly.browserEvents.mouseToSvg,\n\n        workspaceToDom: blockly.Xml.workspaceToDom,\n        textToDom: blockly.Xml.textToDom,\n\n        domToWorkspace: blockly.Xml.domToWorkspace,\n        domToVariables: blockly.Xml.domToVariables,\n        domToText: blockly.Xml.domToText,\n\n        blockToXml: function (block: BlockSvg): string {\n            const xmlDom = blockly.Xml.blockToDomWithXY(block, true);\n            blockly.Xml.deleteNext(xmlDom);\n\n            const xmlText = blockly.Xml.domToText(xmlDom).replace(\n                'xmlns=\"https://developers.google.com/blockly/xml\"',\n                \"\",\n            );\n\n            return xmlText;\n        },\n    };\n\n    return self;\n}\n\nconst BlocklyWrapper = blocklyWrapper(_Blockly, Blockly);\n\ninterface BlocklyConfig {\n    menus: {\n        [key: string]: RegistryMenuItem;\n    };\n    items: {\n        [key: string]: RegistryItem;\n    };\n}\n\nconst blocklyConfig: BlocklyConfig = {\n    menus: {},\n    items: {},\n};\n\ninterface BlockLookup {\n    type: string;\n    category: string;\n    internalName: string;\n    displayName: string;\n}\n\ninterface BlockCategory {\n    internalName: string;\n    displayName: string;\n    contents: Array<BlockLookup>;\n}\n\nexport interface MouseCoords {\n    x: number;\n    y: number;\n}\n\ninterface LastContextMenu {\n    e: Event;\n    options: Array<MenuOption>;\n    rtl: boolean;\n}\n\n//NOTE: This is a subset of ContextMenuOption\nexport interface MenuOption {\n    text: string;\n    enabled: boolean;\n    callback: () => void;\n}\n\nexport type RegistryMenuItem = RegistryItem & {\n    options: Array<string>;\n};\n\nconst mouseCoords: MouseCoords = {\n    x: 0,\n    y: 0,\n};\n\ninterface JsonWorkspaceFile {\n    variables: string;\n    mainWorkspace: string;\n}\n\nconst contextMenuStack: Array<Array<MenuOption>> = [];\nlet lastContextMenu: LastContextMenu = undefined;\n\nconst blockLookup: Array<BlockLookup> = [];\nconst blockCategories: Array<BlockCategory> = [];\n\nconst selectedBlocks: Array<BlockSvg> = [];\n\nlet shiftKey = false;\n\nconst imageDataUrlCache = new Map<string, string>();\n\n//Blockly functions - Items\nfunction copyToClipboard(): RegistryItem {\n    const errorMessage = \"Failed to copy to clipboard!\";\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    async function callback(scope: Scope): Promise<void> {\n        try {\n            const blocks = getSelectedBlocks(scope);\n            const xmlText = saveXml(blocks);\n\n            if (!xmlText) {\n                alert(errorMessage);\n\n                return;\n            }\n\n            await BF2042Portal.Shared.copyTextToClipboard(xmlText);\n        } catch (e) {\n            BF2042Portal.Shared.logError(errorMessage, e);\n\n            alert(errorMessage);\n        }\n    }\n\n    return {\n        id: \"copyToClipboard\",\n        displayText: \"Copy to Clipboard\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction pasteFromClipboard(): RegistryItem {\n    const errorMessage = \"Failed to paste from clipboard!\";\n\n    //NOTE: Unfortunately precondition cannot be async, so we cannot check if the clipboard contains valid XML beforehand.\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    async function callback(): Promise<void> {\n        try {\n            const xmlText = await BF2042Portal.Shared.pasteTextFromClipboard();\n\n            if (!loadXml(xmlText)) {\n                alert(errorMessage);\n            }\n        } catch (e) {\n            BF2042Portal.Shared.logError(errorMessage, e);\n\n            alert(errorMessage);\n        }\n    }\n\n    return {\n        id: \"pasteFromClipboard\",\n        displayText: \"Paste from Clipboard\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction toggleComments(): RegistryItem {\n    function displayText(scope: Scope): string {\n        const toggleType = scope.block.getCommentIcon() ? \"Remove\" : \"Add\";\n\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks.length === 1) {\n            return `${toggleType} Comment`;\n        }\n\n        return `${toggleType} Comment (${blocks.length} Blocks)`;\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const commentText = scope.block.getCommentIcon() ? null : \"\";\n\n        const blocks = getSelectedBlocks(scope);\n\n        for (let i = 0; i < blocks.length; i++) {\n            blocks[i].setCommentText(commentText);\n        }\n    }\n\n    return {\n        id: \"toggleComments\",\n        displayText: displayText,\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction toggleInputs(): RegistryItem {\n    function displayText(scope: Scope): string {\n        const toggleType = scope.block.getInputsInline()\n            ? \"Vertically\"\n            : \"Horizontally\";\n\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks.length === 1) {\n            return `Show Inputs ${toggleType}`;\n        }\n\n        return `Show Inputs ${toggleType} (${blocks.length} Blocks)`;\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const isInputInline = !scope.block.getInputsInline();\n\n        const blocks = getSelectedBlocks(scope);\n\n        for (let i = 0; i < blocks.length; i++) {\n            blocks[i].setInputsInline(isInputInline);\n        }\n    }\n\n    return {\n        id: \"toggleInputs\",\n        displayText: displayText,\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction toggleCollapse(): RegistryItem {\n    function displayText(scope: Scope): string {\n        const toggleType = scope.block.isCollapsed() ? \"Expand\" : \"Collapse\";\n\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks.length === 1) {\n            return `${toggleType} Block`;\n        }\n\n        return `${toggleType} ${blocks.length} Blocks`;\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const isCollapsed = !scope.block.isCollapsed();\n\n        const blocks = getSelectedBlocks(scope);\n\n        for (let i = 0; i < blocks.length; i++) {\n            blocks[i].setCollapsed(isCollapsed);\n        }\n    }\n\n    return {\n        id: \"toggleCollapse\",\n        displayText: displayText,\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction collapseAllBlocks(): RegistryItem {\n    function displayText(scope: Scope): string {\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks) {\n            if (blocks.length === 1) {\n                return \"Collapse Block\";\n            }\n\n            return `Collapse ${blocks.length} Blocks`;\n        }\n\n        return \"Collapse All Blocks\";\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks) {\n            for (let i = 0; i < blocks.length; i++) {\n                blocks[i].setCollapsed(true);\n            }\n        } else {\n            const workspace = BlocklyWrapper.getMainWorkspace();\n\n            for (const block of workspace.getAllBlocks(false)) {\n                block.setCollapsed(true);\n            }\n        }\n    }\n\n    return {\n        id: \"collapseAllBlocks\",\n        displayText: displayText,\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction expandAllBlocks(): RegistryItem {\n    function displayText(scope: Scope): string {\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks) {\n            if (blocks.length === 1) {\n                return \"Expand Block\";\n            }\n\n            return `Expand ${blocks.length} Blocks`;\n        }\n\n        return \"Expand All Blocks\";\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const blocks = getSelectedBlocks(scope);\n\n        if (blocks) {\n            for (let i = 0; i < blocks.length; i++) {\n                blocks[i].setCollapsed(false);\n            }\n        } else {\n            const workspace = BlocklyWrapper.getMainWorkspace();\n\n            for (const block of workspace.getAllBlocks(false)) {\n                block.setCollapsed(false);\n            }\n        }\n    }\n\n    return {\n        id: \"expandAllBlocks\",\n        displayText: displayText,\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction deleteModBlock(): RegistryItem {\n    function precondition(scope: Scope): string {\n        if (\n            scope.block.type === \"modBlock\" &&\n            BlocklyWrapper.getMainWorkspace().getBlocksByType(\"modBlock\", false)\n                .length > 1\n        ) {\n            return \"enabled\";\n        }\n\n        return \"hidden\";\n    }\n\n    function callback(scope: Scope): void {\n        scope.block.dispose(false, false);\n    }\n\n    return {\n        id: \"deleteModBlock\",\n        displayText: \"Delete Mod Block\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction openDocumentation(): RegistryItem {\n    const documentationUrl = \"https://docs.bfportal.gg/blocks\";\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(): void {\n        window.open(documentationUrl, \"bf2042_documentation\");\n    }\n\n    return {\n        id: \"openDocumentation\",\n        displayText: \"Open Documentation\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction jumpToSubRoutine(): RegistryItem {\n    function precondition(scope: Scope): string {\n        if (scope.block.type === \"subroutineInstanceBlock\") {\n            return \"enabled\";\n        }\n\n        return \"hidden\";\n    }\n\n    function callback(scope: Scope): void {\n        const subroutineName = scope.block.getFieldValue(\"SUBROUTINE_NAME\");\n\n        const foundBlocks = BlocklyWrapper.getMainWorkspace()\n            .getBlocksByType(\"subroutineBlock\", false)\n            .filter(\n                (e: Block) =>\n                    e.getFieldValue(\"SUBROUTINE_NAME\") === subroutineName,\n            );\n\n        if (foundBlocks.length > 0) {\n            BlocklyWrapper.getMainWorkspace().centerOnBlock(foundBlocks[0].id);\n        }\n    }\n\n    return {\n        id: \"jumpToSubRoutine\",\n        displayText: \"Jump to Subroutine\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction toggleDistractionFreeMode(): RegistryItem {\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(): void {\n        document.querySelector(\"app-root\").classList.toggle(\"distraction-free\");\n\n        BlocklyWrapper.getMainWorkspace().resize();\n    }\n\n    return {\n        id: \"toggleDistractionFreeMode\",\n        displayText: \"Toggle Distraction-Free Mode\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction toggleToolbox(): RegistryItem {\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(): void {\n        document.querySelector(\"app-root\").classList.toggle(\"hide-toolbox\");\n\n        BlocklyWrapper.getMainWorkspace().resize();\n    }\n\n    return {\n        id: \"toggleToolbox\",\n        displayText: \"Toggle Toolbox\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction exportBlocksWorkspace(): RegistryItem {\n    return exportBlocks(\n        \"exportBlocksWorkspace\",\n        BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n    );\n}\n\nfunction exportBlocksBlock(): RegistryItem {\n    return exportBlocks(\n        \"exportBlocksBlock\",\n        BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n    );\n}\n\nfunction exportBlocks(id: string, scopeType: ScopeType): RegistryItem {\n    interface SvgData {\n        width: number;\n        height: number;\n        svgDataURL: string;\n    }\n\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const menuItems = [\n            {\n                text: \"XML\",\n                enabled: true,\n                callback: () => exportToXml(scope),\n            },\n            {\n                text: \"SVG\",\n                enabled: true,\n                callback: () => exportToSvg(scope),\n            },\n            {\n                text: \"PNG\",\n                enabled: true,\n                callback: () => exportToPngAsFile(scope),\n            },\n        ];\n\n        if (BF2042Portal.Shared.isCopyBlobToClipboardSupported()) {\n            menuItems.push({\n                text: \"PNG (Clipboard)\",\n                enabled: true,\n                callback: () => exportToPngOnClipboard(scope),\n            });\n        }\n\n        showContextMenuWithBack(menuItems);\n    }\n\n    async function exportToXml(scope: Scope): Promise<void> {\n        const blocks = getSelectedBlocks(scope);\n        const xmlText = saveXml(blocks);\n\n        if (!xmlText) {\n            alert(\"Failed to export XML!\");\n\n            return;\n        }\n\n        const dataUri = `data:application/xml;charset=utf-8,${encodeURIComponent(\n            xmlText,\n        )}`;\n\n        downloadFile(dataUri, \"workspace.xml\");\n    }\n\n    async function exportToSvg(scope: Scope): Promise<void> {\n        const blocks = getSelectedBlocks(scope);\n        const svgData = await blocksToSvg(blocks, false);\n\n        downloadFile(svgData.svgDataURL, \"screenshot.svg\");\n    }\n\n    async function exportToPngAsFile(scope: Scope): Promise<void> {\n        try {\n            const blocks = getSelectedBlocks(scope);\n            const svgData = await blocksToSvg(blocks, true);\n            const pngData = (await svgToData(svgData, 1, \"png\")) as string;\n\n            downloadFile(pngData, \"screenshot.png\");\n        } catch (e) {\n            BF2042Portal.Shared.logError(\"Failed to export PNG (Download)\", e);\n\n            alert(\"Failed to export PNG (Download)!\");\n        }\n    }\n\n    async function exportToPngOnClipboard(scope: Scope): Promise<void> {\n        try {\n            const blocks = getSelectedBlocks(scope);\n            const svgData = await blocksToSvg(blocks, true);\n            const blobData = (await svgToData(svgData, 1, \"blob\")) as Blob;\n\n            await BF2042Portal.Shared.copyBlobToClipboard(blobData);\n\n            alert(\"Done!\");\n        } catch (e) {\n            BF2042Portal.Shared.logError(\"Failed to export PNG (Clipboard)\", e);\n\n            alert(\"Failed to export PNG (Clipboard)!\");\n        }\n    }\n\n    //Based on: https://github.com/google/blockly/blob/master/tests/playgrounds/screenshot.js\n    async function blocksToSvg(\n        blocks: Array<BlockSvg>,\n        convertImagesToDataURI: boolean,\n    ): Promise<SvgData> {\n        const workspace = BlocklyWrapper.getMainWorkspace();\n        let x: number, y: number, width: number, height: number;\n\n        if (blocks && blocks.length > 0) {\n            //Determine bounding box of the selection\n            let minX, minY, maxX, maxY;\n\n            for (let i = 0; i < blocks.length; i++) {\n                const block = blocks[i];\n                const xy = block.getRelativeToSurfaceXY();\n\n                if (!minX || xy.x < minX) {\n                    minX = xy.x;\n                }\n\n                if (!minY || xy.y < minY) {\n                    minY = xy.y;\n                }\n\n                if (!maxX || xy.x + block.width > maxX) {\n                    maxX = xy.x + block.width;\n                }\n\n                if (!maxY || xy.y + block.height > maxY) {\n                    maxY = xy.y + block.height;\n                }\n            }\n\n            x = minX;\n            y = minY;\n            width = maxX - minX;\n            height = maxY - minY;\n        } else {\n            const boundingBox = workspace.getBlocksBoundingBox();\n            x = boundingBox.left;\n            y = boundingBox.top;\n            width = boundingBox.right - x;\n            height = boundingBox.bottom - y;\n        }\n\n        const blockCanvas = workspace.getCanvas();\n        const clone = blockCanvas.cloneNode(true) as SVGGElement;\n        clone.removeAttribute(\"transform\");\n\n        const svg = document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            \"svg\",\n        );\n        svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n        svg.appendChild(clone);\n        svg.setAttribute(\"viewBox\", `${x} ${y} ${width} ${height}`);\n        svg.setAttribute(\n            \"class\",\n            `blocklySvg ${workspace.options.renderer || \"geras\"}-renderer ${\n                workspace.getTheme ? workspace.getTheme().name + \"-theme\" : \"\"\n            }`,\n        );\n        svg.setAttribute(\"width\", width.toString());\n        svg.setAttribute(\"height\", height.toString());\n        svg.setAttribute(\"style\", \"background-color: transparent\");\n\n        const css = [].slice\n            .call(document.head.querySelectorAll(\"style\"))\n            .filter(function (el: HTMLStyleElement) {\n                return (\n                    /\\.blocklySvg/.test(el.innerText) ||\n                    el.id.indexOf(\"blockly-\") === 0\n                );\n            })\n            .map(function (el: HTMLStyleElement) {\n                return el.innerText;\n            })\n            .join(\"\");\n\n        const style = document.createElement(\"style\");\n        style.innerHTML = css;\n        svg.insertBefore(style, svg.firstChild);\n\n        let svgAsXML = new XMLSerializer()\n            .serializeToString(svg)\n            .replace(/&nbsp/g, \"&#160\");\n\n        if (convertImagesToDataURI) {\n            const matches = [...svgAsXML.matchAll(/xlink:href=\"(.*?)\"/g)];\n\n            for (const match of matches) {\n                const url = match[1];\n\n                if (url.startsWith(\"data:\") || imageDataUrlCache.has(url)) {\n                    continue;\n                }\n\n                try {\n                    const dataUrl = await new Promise<string>(\n                        // eslint-disable-next-line no-async-promise-executor, @typescript-eslint/typedef\n                        async (resolve, reject) => {\n                            try {\n                                //TODO: Implement a time-out mechanism\n                                const response = await fetch(\n                                    \"https://portal.battlefield.com\" + url,\n                                );\n\n                                const blob = await response.blob();\n\n                                const reader = new FileReader();\n                                reader.onload = (\n                                    f: ProgressEvent<FileReader>,\n                                ): void => {\n                                    resolve(f.target.result as string);\n                                };\n                                reader.readAsDataURL(blob);\n                            } catch (_) {\n                                reject();\n                            }\n                        },\n                    );\n\n                    imageDataUrlCache.set(url, dataUrl);\n                } catch (_) {\n                    imageDataUrlCache.set(url, url);\n                }\n            }\n        }\n\n        svgAsXML = svgAsXML.replace(\n            /xlink:href=\"(.*?)\"/g,\n            function (_: string, url: string) {\n                const newUrl = imageDataUrlCache.has(url)\n                    ? imageDataUrlCache.get(url)\n                    : url;\n\n                return `xlink:href=\"${newUrl}\"`;\n            },\n        );\n\n        const data = `data:image/svg+xml,${encodeURIComponent(svgAsXML)}`;\n\n        return {\n            width: width,\n            height: height,\n            svgDataURL: data,\n        };\n    }\n\n    async function svgToData(\n        svgData: SvgData,\n        scale: number,\n        dataType: string,\n    ): Promise<string | Blob> {\n        // eslint-disable-next-line @typescript-eslint/typedef\n        const promise = new Promise<string | Blob>((resolve, reject) => {\n            const canvas = document.createElement(\"canvas\");\n            const context = canvas.getContext(\"2d\");\n            const img = new Image();\n\n            canvas.width = svgData.width * scale;\n            canvas.height = svgData.height * scale;\n\n            if (canvas.width > 16384 || canvas.height > 16384) {\n                reject(\n                    \"The resulting image would be too large to handle for your browser. Please select less blocks or reduce the scale.\",\n                );\n            }\n\n            img.onload = function (): void {\n                context.drawImage(\n                    img,\n                    0,\n                    0,\n                    svgData.width,\n                    svgData.height,\n                    0,\n                    0,\n                    canvas.width,\n                    canvas.height,\n                );\n\n                try {\n                    if (dataType === \"png\") {\n                        const dataUri = canvas.toDataURL(\"image/png\");\n\n                        resolve(dataUri);\n                    } else if (dataType === \"blob\") {\n                        canvas.toBlob(function (blob: Blob): void {\n                            resolve(blob);\n                        });\n                    } else {\n                        throw \"Unknown type\";\n                    }\n                } catch (e) {\n                    reject(`Failed to convert SVG: ${e}`);\n                }\n            };\n\n            img.src = svgData.svgDataURL;\n        });\n\n        return promise;\n    }\n\n    function downloadFile(fileData: string, fileName: string): void {\n        const linkElement = document.createElement(\"a\");\n        linkElement.setAttribute(\"href\", fileData);\n        linkElement.setAttribute(\"download\", fileName);\n        linkElement.style.display = \"none\";\n\n        document.body.appendChild(linkElement);\n        linkElement.click();\n        document.body.removeChild(linkElement);\n    }\n\n    return {\n        id: id,\n        displayText: \"Export Blocks >\",\n        scopeType: scopeType,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction importBlocksFromFile(): RegistryItem {\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(): void {\n        const inputElement = document.createElement(\"input\");\n        inputElement.setAttribute(\"type\", \"file\");\n        inputElement.setAttribute(\"accept\", \".xml,.json\");\n        inputElement.style.display = \"none\";\n\n        inputElement.addEventListener(\"change\", function () {\n            if (!inputElement.files || inputElement.files.length === 0) {\n                return;\n            }\n\n            const fileReader = new FileReader();\n            fileReader.onload = function (e: ProgressEvent<FileReader>): void {\n                if (\n                    confirm(\n                        \"Do you want to remove all existing blocks before importing?\",\n                    )\n                ) {\n                    BlocklyWrapper.getMainWorkspace().clear();\n                }\n\n                try {\n                    const extension = inputElement.files[0].name\n                        .split(\".\")\n                        .pop()\n                        .toLowerCase();\n\n                    if (extension === \"json\") {\n                        const loadData = JSON.parse(e.target.result as string);\n\n                        if (!loadJson(loadData)) {\n                            alert(\"Failed to import workspace from JSON!\");\n                        }\n                    } else if (extension === \"xml\") {\n                        if (!loadXml(e.target.result as string)) {\n                            alert(\"Failed to import workspace from XML!\");\n                        }\n                    }\n                } catch (e) {\n                    alert(\"Failed to import workspace!\");\n                }\n            };\n\n            fileReader.readAsText(inputElement.files[0]);\n        });\n\n        document.body.appendChild(inputElement);\n        inputElement.click();\n        document.body.removeChild(inputElement);\n    }\n\n    return {\n        id: \"importBlocksFromFile\",\n        displayText: \"Import Blocks from File\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction addBlock(): RegistryItem {\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    //TODO: Variables/Subroutines\n    function callback(): void {\n        const options: Array<MenuOption> = [];\n\n        for (let i = 0; i < blockCategories.length; i++) {\n            const entry = blockCategories[i];\n\n            options.push({\n                text: entry.displayName,\n                enabled: true,\n                callback: function () {\n                    const subOptions: Array<MenuOption> = [];\n\n                    for (let i2 = 0; i2 < entry.contents.length; i2++) {\n                        const entry2 = entry.contents[i2];\n\n                        let role;\n\n                        switch (entry2.type) {\n                            case \"mod\":\n                                role = \"âš«\";\n                                break;\n\n                            case \"rule\":\n                            case \"controlAction\":\n                                role = \"ðŸŸ£\";\n                                break;\n\n                            case \"condition\":\n                                role = \"ðŸ”µ\";\n                                break;\n\n                            case \"value\":\n                            case \"literal\":\n                                role = \"ðŸŸ¢\";\n                                break;\n\n                            case \"action\":\n                                role = \"ðŸŸ¡\";\n                                break;\n\n                            default:\n                                role = \"âšª\";\n                                break;\n                        }\n\n                        subOptions.push({\n                            text: `${role} ${entry2.displayName}`,\n                            enabled: true,\n                            callback: function () {\n                                const block =\n                                    BlocklyWrapper.getMainWorkspace().newBlock(\n                                        entry2.internalName,\n                                    );\n                                block.initSvg();\n                                block.render();\n\n                                //NOTE: Deliberately cast to Coordinate\n                                block.moveTo(mouseCoords as Coordinate);\n                            },\n                        });\n                    }\n\n                    showContextMenuWithBack(subOptions.sort(sortByText));\n                },\n            });\n        }\n\n        showContextMenuWithBack(options.sort(sortByText));\n    }\n\n    function sortByText(a: MenuOption, b: MenuOption): number {\n        return a.text > b.text ? 1 : -1;\n    }\n\n    return {\n        id: \"addBlock\",\n        displayText: \"Add Block >\",\n        scopeType: BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n    };\n}\n\nfunction separatorWorkspace(): RegistryItem {\n    return separator(\n        \"separatorWorkspace\",\n        BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n    );\n}\n\nfunction separatorBlock(): RegistryItem {\n    return separator(\n        \"separatorBlock\",\n        BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n    );\n}\n\nfunction separator(id: string, scope: ScopeType): RegistryItem {\n    return {\n        id: id,\n        displayText: \"---\",\n        scopeType: scope,\n        weight: 100,\n        preconditionFn: () => \"disabled\",\n        callback: (): void => {\n            //Do nothing\n        },\n    };\n}\n\n//Blockly functions - Menus\nfunction optionsWorkspace(): RegistryMenuItem {\n    return createMenu(\n        \"optionsWorkspace\",\n        \"Options\",\n        BlocklyWrapper.ContextMenu.ScopeType.WORKSPACE,\n    );\n}\n\nfunction optionsBlock(): RegistryMenuItem {\n    return createMenu(\n        \"optionsBlock\",\n        \"Options\",\n        BlocklyWrapper.ContextMenu.ScopeType.BLOCK,\n    );\n}\n\nfunction createMenu(\n    id: string,\n    name: string,\n    scopeType: ScopeType,\n): RegistryMenuItem {\n    function precondition(): string {\n        return \"enabled\";\n    }\n\n    function callback(scope: Scope): void {\n        const menu = blocklyConfig.menus[id];\n        const subMenuOptions: Array<MenuOption> = [];\n\n        for (let i = 0; i < menu.options.length; i++) {\n            const subMenuItem = createSubMenuItem(\n                menu.options[i],\n                scopeType,\n                scope,\n            );\n\n            if (!subMenuItem) {\n                continue;\n            }\n\n            subMenuOptions.push(subMenuItem);\n        }\n\n        showContextMenuWithBack(subMenuOptions);\n    }\n\n    return {\n        id: id,\n        displayText: `${name} >`,\n        scopeType: scopeType,\n        weight: 100,\n        preconditionFn: precondition,\n        callback: callback,\n        options: [],\n    };\n}\n\nfunction createSubMenuItem(\n    id: string,\n    scopeType: ScopeType,\n    scope: Scope,\n): MenuOption {\n    let data: RegistryItem | RegistryMenuItem;\n\n    if (id.startsWith(\"items.\")) {\n        data = blocklyConfig.items[id.substring(\"items.\".length)];\n    } else if (id.startsWith(\"menus.\")) {\n        data = blocklyConfig.menus[id.substring(\"menus.\".length)];\n    }\n\n    if (!data || data.scopeType !== scopeType) {\n        return undefined;\n    }\n\n    return {\n        text:\n            typeof data.displayText === \"string\"\n                ? data.displayText\n                : data.displayText(scope),\n        enabled: data.preconditionFn(scope) === \"enabled\",\n        callback: () => data.callback(scope),\n    };\n}\n\n//Blockly functions - Helpers\nfunction registerMenu(menu: RegistryMenuItem): void {\n    blocklyConfig.menus[menu.id] = menu;\n}\n\nfunction registerItem(item: RegistryItem): void {\n    blocklyConfig.items[item.id] = item;\n}\n\n//Private functions\nfunction saveXml(blocks: Array<BlockSvg>): string {\n    const workspace = BlocklyWrapper.getMainWorkspace();\n\n    try {\n        let xmlText = \"\";\n\n        if (blocks && blocks.length > 0) {\n            for (let i = 0; i < blocks.length; i++) {\n                xmlText += BlocklyWrapper.Xml.blockToXml(blocks[i]);\n            }\n\n            return xmlText;\n        } else {\n            const xmlDom = BlocklyWrapper.Xml.workspaceToDom(workspace, true);\n\n            const variablesXml = xmlDom.querySelector(\"variables\");\n\n            if (variablesXml) {\n                xmlDom.removeChild(variablesXml);\n            }\n\n            return BlocklyWrapper.Xml.domToText(xmlDom)\n                .replace(\n                    '<xml xmlns=\"https://developers.google.com/blockly/xml\">',\n                    \"\",\n                )\n                .replace(\"</xml>\", \"\");\n        }\n    } catch (e) {\n        BF2042Portal.Shared.logError(\"Failed to save workspace!\", e);\n    }\n\n    return undefined;\n}\n\nfunction loadJson(data: JsonWorkspaceFile): boolean {\n    const workspace = BlocklyWrapper.getMainWorkspace();\n\n    try {\n        const variables = BlocklyWrapper.Xml.textToDom(\n            data.variables ? data.variables : \"<xml />\",\n        );\n\n        BlocklyWrapper.Xml.domToVariables(variables, workspace);\n        BlocklyWrapper.Xml.domToWorkspace(\n            BlocklyWrapper.Xml.textToDom(data.mainWorkspace),\n            workspace,\n        );\n\n        return true;\n    } catch (e) {\n        BF2042Portal.Shared.logError(\"Failed to load workspace from JSON!\", e);\n    }\n\n    return false;\n}\n\nfunction loadXml(xmlText: string): boolean {\n    try {\n        if (!xmlText) {\n            return false;\n        }\n\n        xmlText = xmlText.trim();\n\n        if (!xmlText.startsWith(\"<block\")) {\n            return false;\n        }\n\n        const domText = `<xml xmlns=\"https://developers.google.com/blockly/xml\">${xmlText.trim()}</xml>`;\n\n        const xmlDom = BlocklyWrapper.Xml.textToDom(domText);\n\n        //NOTE: Extract variables\n        const variableBlocks = xmlDom.querySelectorAll(\n            \"block[type='variableReferenceBlock']\",\n        );\n\n        interface Variable {\n            objectType: string;\n            variableName: string;\n        }\n\n        const variables: Array<Variable> = [];\n\n        variableBlocks.forEach((e: Element) => {\n            const objectType = e.querySelector(\n                \"field[name='OBJECTTYPE']\",\n            ).textContent;\n            const variableName =\n                e.querySelector(\"field[name='VAR']\").textContent;\n\n            if (\n                objectType &&\n                variableName &&\n                !variables.find(\n                    (v: Variable) =>\n                        v.objectType === objectType &&\n                        v.variableName === variableName,\n                )\n            ) {\n                variables.push({\n                    objectType,\n                    variableName,\n                });\n            }\n        });\n\n        const variablesXml = document.createElement(\"variables\");\n\n        variables.forEach((e: Variable) => {\n            const variable = document.createElement(\"variable\");\n            variable.setAttribute(\"type\", e.objectType);\n            variable.innerText = e.variableName;\n\n            variablesXml.appendChild(variable);\n        });\n\n        BlocklyWrapper.Xml.domToVariables(\n            variablesXml,\n            BlocklyWrapper.getMainWorkspace(),\n        );\n\n        //NOTE: Determine a bounding box\n        let minX: number;\n        let minY: number;\n\n        for (let i = 0; i < xmlDom.childNodes.length; i++) {\n            const block = xmlDom.childNodes[i] as Element;\n\n            const x = parseInt(block.getAttribute(\"x\"));\n            const y = parseInt(block.getAttribute(\"y\"));\n\n            if (!minX || x < minX) {\n                minX = x;\n            }\n\n            if (!minY || y < minY) {\n                minY = y;\n            }\n        }\n\n        //NOTE: Transform blocks to the minimum coords, then move them to their target position.\n        for (let i = 0; i < xmlDom.childNodes.length; i++) {\n            const block = xmlDom.childNodes[i] as Element;\n\n            const x = parseInt(block.getAttribute(\"x\"));\n            const y = parseInt(block.getAttribute(\"y\"));\n\n            if (x === minX) {\n                block.setAttribute(\"x\", mouseCoords.x.toString());\n            } else {\n                block.setAttribute(\"x\", (x - minX + mouseCoords.x).toString());\n            }\n\n            if (y === minY) {\n                block.setAttribute(\"y\", mouseCoords.y.toString());\n            } else {\n                block.setAttribute(\"y\", (y - minY + mouseCoords.y).toString());\n            }\n        }\n\n        BlocklyWrapper.Xml.domToWorkspace(\n            xmlDom,\n            BlocklyWrapper.getMainWorkspace(),\n        );\n\n        return true;\n    } catch (e) {\n        BF2042Portal.Shared.logError(\"Failed to load workspace from XML!\", e);\n    }\n\n    return false;\n}\n\n//Based on: https://stackoverflow.com/questions/32589197/how-can-i-capitalize-the-first-letter-of-each-word-in-a-string-using-javascript\nfunction titleCase(value: string): string {\n    return value\n        .split(\" \")\n        .map(\n            (s: string) =>\n                s.charAt(0).toUpperCase() + s.substring(1).toLowerCase(),\n        )\n        .join(\" \");\n}\n\n//API functions\nfunction getSelectedBlocks(scope: Scope): Array<BlockSvg> {\n    let blocks = undefined;\n\n    if (selectedBlocks.length > 0) {\n        blocks = selectedBlocks;\n    }\n\n    if (\n        !blocks &&\n        (BlocklyWrapper.Blocks.getSelected() ||\n            (scope !== undefined && scope.block))\n    ) {\n        blocks = [BlocklyWrapper.Blocks.getSelected() || scope.block];\n    }\n\n    return blocks;\n}\n\nfunction getMouseCoords(): MouseCoords {\n    return {\n        x: mouseCoords.x,\n        y: mouseCoords.y,\n    };\n}\n\nfunction showContextMenuWithBack(options: Array<MenuOption>): void {\n    contextMenuStack.push(lastContextMenu.options);\n\n    BlocklyWrapper.ContextMenu.show(\n        lastContextMenu.e,\n        []\n            .concat(\n                {\n                    text: \"< Back\",\n                    enabled: true,\n                    callback: () => {\n                        const menu = contextMenuStack.splice(\n                            contextMenuStack.length - 1,\n                            1,\n                        );\n\n                        //NOTE: Deliberately cast to ContextMenuOption\n                        BlocklyWrapper.ContextMenu.show(\n                            lastContextMenu.e,\n                            menu[0] as unknown as Array<ContextMenuOption>,\n                            lastContextMenu.rtl,\n                        );\n                    },\n                },\n                {\n                    text: \"---\",\n                    enabled: false,\n                    callback: () => {\n                        //Do nothing\n                    },\n                },\n            )\n            .concat(options),\n        lastContextMenu.rtl,\n    );\n}\n\nexport interface PluginApi {\n    getSelectedBlocks: typeof getSelectedBlocks;\n    getMouseCoords: typeof getMouseCoords;\n    showContextMenuWithBack: typeof showContextMenuWithBack;\n    registerMenu: typeof registerMenu;\n    registerItem: typeof registerItem;\n    createMenu: typeof createMenu;\n}\n\n//Initialize functions\nexport function init(): void {\n    cssFixes();\n\n    hookContextMenu();\n    hookBlockly();\n\n    initializeBlocks(BF2042Portal.Startup.getBlockDefinitions());\n    initializeDocumentEvents();\n    initializeBlockly();\n\n    pluginInit({\n        api: {\n            getSelectedBlocks: getSelectedBlocks,\n            getMouseCoords: getMouseCoords,\n            showContextMenuWithBack: showContextMenuWithBack,\n            registerMenu: registerMenu,\n            registerItem: registerItem,\n            createMenu: createMenu,\n        },\n        version: BF2042Portal.Startup.getVersion(),\n        pluginManager: BF2042Portal.Startup.getManifest().pluginManager,\n    });\n}\n\nfunction cssFixes(): void {\n    const styleElement = document.createElement(\"style\");\n    styleElement.setAttribute(\"type\", \"text/css\");\n\n    styleElement.innerHTML = `\n        /*.blocklyMenu {\n            overflow-y: hidden !important;\n        }*/\n\n        .distraction-free ea-network-nav, .distraction-free ea-local-nav-advanced {\n            display: none;\n        }\n\n        .distraction-free > div.app {\n            padding-top: 0;\n        }\n\n        .distraction-free .editor-container {\n            grid-template-columns: 0 !important;\n        }\n\n        .hide-toolbox .blocklyToolboxDiv {\n            display: none !important;\n        }\n    `;\n\n    document.head.appendChild(styleElement);\n}\n\nfunction hookContextMenu(): void {\n    const workspace = BlocklyWrapper.getMainWorkspace();\n\n    const workspacePrototype: WorkspaceSvg = Object.getPrototypeOf(workspace);\n    const originalWorkspaceShowContextMenu = workspacePrototype.showContextMenu;\n\n    workspacePrototype.showContextMenu = function (e: MouseEvent): void {\n        //NOTE: Clear the stack every time the content menu is opened at the root\n        contextMenuStack.length = 0;\n\n        //NOTE: Deliberately cast to MenuOption, since only a subset of properties is required.\n        lastContextMenu = {\n            e: e,\n            options: BlocklyWrapper.ContextMenu.getOptionsForWorkspace(\n                this,\n            ) as unknown as Array<MenuOption>,\n            rtl: this.RTL,\n        };\n\n        updateMouseCoords(e);\n\n        // eslint-disable-next-line prefer-rest-params\n        originalWorkspaceShowContextMenu.apply(this, arguments);\n    };\n\n    const blockPrototype: BlockSvg = Object.getPrototypeOf(\n        workspace.getTopBlocks(false)[0],\n    );\n    const originalBlockShowContextMenu = blockPrototype.showContextMenu;\n\n    blockPrototype.showContextMenu = function (e: MouseEvent): void {\n        //NOTE: Clear the stack every time the content menu is opened at the root\n        contextMenuStack.length = 0;\n\n        //NOTE: Deliberately cast to MenuOption, since only a subset of properties is required.\n        lastContextMenu = {\n            e: e,\n            options: BlocklyWrapper.ContextMenu.getOptionsForBlock(\n                this,\n            ) as unknown as Array<MenuOption>,\n            rtl: this.RTL,\n        };\n\n        updateMouseCoords(e);\n\n        // eslint-disable-next-line prefer-rest-params\n        return originalBlockShowContextMenu.apply(this, arguments);\n    };\n\n    const originalShow = _Blockly.ContextMenu.show;\n\n    _Blockly.ContextMenu.show = function (\n        e: MouseEvent,\n        options: Array<ContextMenuOption>,\n        rtl: boolean,\n    ): void {\n        //NOTE: Deliberately cast to MenuOption, since only a subset of properties is required.\n        lastContextMenu = {\n            e: e,\n            options: options as unknown as Array<MenuOption>,\n            rtl: rtl,\n        };\n\n        updateMouseCoords(e);\n\n        // eslint-disable-next-line prefer-rest-params\n        originalShow.apply(this, arguments);\n    };\n}\n\nfunction hookBlockly(): void {\n    function initializeWorkspace(workspace: WorkspaceSvg): void {\n        //TODO: Properly migrate to JSON instead of XML\n        hotfixDomMutations();\n\n        initializeWorkspaceEvents(workspace);\n\n        //NOTE: Wait for the current JavaScript frame to end, then fire the event for plugins.\n        setTimeout(function () {\n            BF2042Portal.Plugins.initializeWorkspace();\n        }, 0);\n    }\n\n    //NOTE: We have to hook the inject method as it's called whenever the user switches to the Rules Editor.\n    const blockly = _Blockly.inject;\n\n    _Blockly.inject = function (): WorkspaceSvg {\n        // eslint-disable-next-line prefer-rest-params\n        const workspace = blockly.apply(this, arguments);\n\n        initializeWorkspace(workspace);\n\n        return workspace;\n    };\n\n    initializeWorkspace(BlocklyWrapper.getMainWorkspace());\n}\n\nfunction initializeDocumentEvents(): void {\n    document.addEventListener(\"keydown\", function (e: KeyboardEvent) {\n        shiftKey = e.shiftKey;\n    });\n\n    document.addEventListener(\"keyup\", function (e: KeyboardEvent) {\n        shiftKey = e.shiftKey;\n    });\n}\n\nfunction initializeBlockly(): void {\n    //NOTE: Register existing items\n    for (const contentMenuItem of BlocklyWrapper.ContextMenu.getAllItems()) {\n        registerItem(contentMenuItem.value);\n    }\n\n    //NOTE: Delete existing items\n    BlocklyWrapper.ContextMenu.unregisterItem(\"cleanWorkspace\");\n    BlocklyWrapper.ContextMenu.unregisterItem(\"workspaceDelete\");\n\n    const optionsWorkspaceMenu = optionsWorkspace();\n    optionsWorkspaceMenu.weight = -99;\n    optionsWorkspaceMenu.options = [\n        \"items.workspaceDelete\",\n        \"items.separatorWorkspace\",\n        \"items.collapseAllBlocks\",\n        \"items.expandAllBlocks\",\n        \"items.openDocumentation\",\n        \"items.toggleDistractionFreeMode\",\n        \"items.toggleToolbox\",\n        \"items.separatorWorkspace\",\n        \"items.exportBlocksWorkspace\",\n        \"items.importBlocksFromFile\",\n    ];\n\n    const optionsBlockMenu = optionsBlock();\n    optionsBlockMenu.weight = -99;\n    optionsBlockMenu.options = [\n        \"items.deleteModBlock\",\n        \"items.separatorBlock\",\n        \"items.toggleComments\",\n        \"items.toggleInputs\",\n        \"items.toggleCollapse\",\n        \"items.separatorBlock\",\n        \"items.exportBlocksBlock\",\n    ];\n\n    registerMenu(optionsWorkspaceMenu);\n    registerMenu(optionsBlockMenu);\n\n    registerItem(copyToClipboard());\n    registerItem(pasteFromClipboard());\n    registerItem(toggleComments());\n    registerItem(toggleInputs());\n    registerItem(toggleCollapse());\n    registerItem(collapseAllBlocks());\n    registerItem(expandAllBlocks());\n    registerItem(deleteModBlock());\n    registerItem(openDocumentation());\n    registerItem(jumpToSubRoutine());\n    registerItem(toggleDistractionFreeMode());\n    registerItem(toggleToolbox());\n    registerItem(exportBlocksWorkspace());\n    registerItem(exportBlocksBlock());\n    registerItem(importBlocksFromFile());\n    registerItem(separatorWorkspace());\n    registerItem(separatorBlock());\n\n    const addBlockMenuItem = addBlock();\n    addBlockMenuItem.weight = -100;\n\n    registerItem(addBlockMenuItem);\n\n    const contextMenuStructure = [\n        \"items.addBlock\",\n        \"menus.optionsWorkspace\",\n        \"menus.optionsBlock\",\n        \"items.cleanWorkspace\",\n        \"items.jumpToSubRoutine\",\n        \"items.copyToClipboard\",\n        \"items.pasteFromClipboard\",\n    ];\n\n    //TODO: Give plugins a chance to modify this\n\n    contextMenuStructure.forEach(function (item: string) {\n        let menuItem;\n\n        if (item.startsWith(\"items.\")) {\n            const itemId = item.substring(\"items.\".length);\n            menuItem = blocklyConfig.items[itemId];\n        } else if (item.startsWith(\"menus.\")) {\n            const menuId = item.substring(\"menus.\".length);\n            menuItem = blocklyConfig.menus[menuId];\n        }\n\n        if (!menuItem) {\n            return;\n        }\n\n        BlocklyWrapper.ContextMenu.registerItem(menuItem);\n    });\n}\n\n//Internal functions\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction initializeBlocks(blockDefinitions: any): void {\n    //Blocks - Hard-coded\n    blockLookup.push({\n        type: \"mod\",\n        category: getCategory(\"RULES\"),\n        internalName: \"modBlock\",\n        displayName: titleCase(BlocklyWrapper.getTranslation(\"PYRITE_MOD\")),\n    });\n\n    blockLookup.push({\n        type: \"rule\",\n        category: getCategory(\"RULES\"),\n        internalName: \"ruleBlock\",\n        displayName: titleCase(BlocklyWrapper.getTranslation(\"PYRITE_RULE\")),\n    });\n\n    blockLookup.push({\n        type: \"condition\",\n        category: getCategory(\"RULES\"),\n        internalName: \"conditionBlock\",\n        displayName: titleCase(\n            BlocklyWrapper.getTranslation(\"PYRITE_CONDITION\"),\n        ),\n    });\n\n    blockLookup.push({\n        type: \"literal\",\n        category: getCategory(\"LITERALS\"),\n        internalName: \"Boolean\",\n        displayName: BlocklyWrapper.getTranslation(\"PYRITE_TYPE_BOOLEAN\"),\n    });\n\n    blockLookup.push({\n        type: \"literal\",\n        category: getCategory(\"LITERALS\"),\n        internalName: \"Number\",\n        displayName: BlocklyWrapper.getTranslation(\"PYRITE_TYPE_NUMBER\"),\n    });\n\n    blockLookup.push({\n        type: \"literal\",\n        category: getCategory(\"LITERALS\"),\n        internalName: \"Text\",\n        displayName: BlocklyWrapper.getTranslation(\"PYRITE_TYPE_STRING\"),\n    });\n\n    blockLookup.push({\n        type: \"value\",\n        category: getCategory(\"ARRAYS\"),\n        internalName: \"ArrayContains\",\n        displayName: BlocklyWrapper.getTranslation(\n            \"PYRITE_CONVENIENCE_ARRAYCONTAINS\",\n        ),\n    });\n\n    blockLookup.push({\n        type: \"value\",\n        category: getCategory(\"ARRAYS\"),\n        internalName: \"IndexOfArrayValue\",\n        displayName: BlocklyWrapper.getTranslation(\n            \"PYRITE_CONVENIENCE_INDEXOFARRAYVALUE\",\n        ),\n    });\n\n    blockLookup.push({\n        type: \"value\",\n        category: getCategory(\"ARRAYS\"),\n        internalName: \"RemoveFromArray\",\n        displayName: BlocklyWrapper.getTranslation(\n            \"PYRITE_CONVENIENCE_REMOVEFROMARRAY\",\n        ),\n    });\n\n    blockLookup.push({\n        type: \"value\",\n        category: getCategory(\"SUBROUTINES\"),\n        internalName: \"subroutineArgumentBlock\",\n        displayName: \"GetSubroutineArgument\"\n    });\n\n    blockLookup.push({\n        type: \"action\",\n        category: getCategory(\"CONVENIENCE\"),\n        internalName: \"actionComment\",\n        displayName: \"Comment\"\n    });\n\n    //Blocks - Selection Lists\n    const selectionLists = [\n        ...new Set(\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            blockDefinitions.selectionLists.map(\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                (e: any) => e.listType + \"Item\",\n            ),\n        ),\n    ];\n\n    //Blocks - Values (Yellow)\n    const ignoreValueBlocks = [\n        \"GetArgument\"\n    ];\n\n    for (let index = 0; index < blockDefinitions.values.length; index++) {\n        const element = blockDefinitions.values[index];\n\n        //NOTE: Some values have no category...\n        if (!element.category) {\n            if (ignoreValueBlocks.includes(element.name)) {\n                continue;\n            }\n\n            if (element.name === \"GetVariable\") {\n                element.category = \"VARIABLES\";\n            } else if (selectionLists.includes(element.name)) {\n                element.category = \"SELECTION_LISTS\";\n            } else {\n                BF2042Portal.Shared.logError(\n                    \"No category found for value-block\",\n                    element,\n                );\n            }\n        }\n\n        blockLookup.push({\n            type: \"value\",\n            category: getCategory(element.category),\n            internalName: element.name,\n            displayName:\n                BlocklyWrapper.getTranslation(element.displayNameSID) ||\n                element.name,\n        });\n    }\n\n    //Blocks - Actions (Green)\n    for (let index = 0; index < blockDefinitions.actions.length; index++) {\n        const element = blockDefinitions.actions[index];\n\n        //NOTE: Some values have no category...\n        if (!element.category) {\n            if (element.name === \"SetVariable\") {\n                element.category = \"VARIABLES\";\n            } else {\n                BF2042Portal.Shared.logError(\n                    \"No category found for action-block\",\n                    element,\n                );\n            }\n        }\n\n        blockLookup.push({\n            type: \"action\",\n            category: getCategory(element.category),\n            internalName: element.name,\n            displayName:\n                BlocklyWrapper.getTranslation(element.displayNameSID) ||\n                element.name,\n        });\n    }\n\n    //Blocks - Controls Actions\n    for (\n        let index = 0;\n        index < blockDefinitions.controlActions.length;\n        index++\n    ) {\n        const element = blockDefinitions.controlActions[index];\n\n        blockLookup.push({\n            type: \"controlAction\",\n            category: getCategory(\"CONTROL_ACTIONS\"),\n            internalName: element.name,\n            displayName:\n                BlocklyWrapper.getTranslation(element.displayNameSID) ||\n                element.name,\n        });\n    }\n\n    //Categories\n    blockLookup.forEach((entry: BlockLookup) => {\n        const existingCategory = blockCategories.find(\n            (e: BlockCategory) =>\n                e.internalName === (entry.category || \"Other\"),\n        );\n\n        if (existingCategory) {\n            existingCategory.contents.push(entry);\n        } else {\n            blockCategories.push({\n                internalName: entry.category || \"Other\",\n                displayName: titleCase(entry.category || \"Other\"),\n                contents: [entry],\n            });\n        }\n    });\n\n    function getCategory(key: string): string {\n        if (!key) {\n            return undefined;\n        }\n\n        return BlocklyWrapper.getTranslation(\n            \"PYRITE_TOOLBOX_\" + key.replace(\" \", \"_\").toUpperCase(),\n        );\n    }\n}\n\nfunction initializeWorkspaceEvents(workspace: WorkspaceSvg): void {\n    let deltaX;\n    let deltaY;\n    let activeBlock: string;\n\n    //NOTE: Yes, this is cheating.\n    type SuperEvent = Click & Selected & BlockDrag & BlockMove;\n\n    workspace.addChangeListener(function (e: SuperEvent) {\n        if (\n            e.type === BlocklyWrapper.Events.CLICK ||\n            e.type === BlocklyWrapper.Events.SELECTED\n        ) {\n            if (shiftKey) {\n                if (!e.blockId) {\n                    return;\n                }\n\n                const block = workspace.getBlockById(e.blockId);\n\n                const selectedIndex = selectedBlocks.indexOf(block);\n\n                if (selectedIndex < 0) {\n                    selectedBlocks.push(block);\n\n                    block.setHighlighted(true);\n                } else {\n                    selectedBlocks.splice(selectedIndex, 1);\n\n                    block.setHighlighted(false);\n                }\n            } else if (selectedBlocks.length > 0) {\n                selectedBlocks.forEach((block: BlockSvg) => {\n                    block.setHighlighted(false);\n                });\n\n                selectedBlocks.length = 0;\n            }\n        } else if (e.type === BlocklyWrapper.Events.BLOCK_DRAG && !e.isStart) {\n            activeBlock = e.blockId;\n        } else if (\n            e.type === BlocklyWrapper.Events.MOVE &&\n            e.newCoordinate &&\n            e.oldCoordinate &&\n            activeBlock\n        ) {\n            const ignoreBlock = activeBlock;\n\n            activeBlock = undefined;\n\n            deltaX = e.newCoordinate.x - e.oldCoordinate.x;\n            deltaY = e.newCoordinate.y - e.oldCoordinate.y;\n\n            for (let i = 0; i < selectedBlocks.length; i++) {\n                const block = selectedBlocks[i];\n\n                if (block.id === ignoreBlock) {\n                    continue;\n                }\n\n                block.moveBy(deltaX, deltaY);\n            }\n        }\n    });\n}\n\n//Based on: https://groups.google.com/g/blockly/c/LXnMujtEzJY/m/FKQjI4OwAwAJ\nfunction updateMouseCoords(event: MouseEvent): void {\n    const mainWorkspace = BlocklyWrapper.getMainWorkspace();\n\n    if (!mainWorkspace) {\n        return;\n    }\n\n    // Gets the x and y position of the cursor relative to the workspace's parent svg element.\n    const mouseXY = BlocklyWrapper.Xml.mouseToSvg(\n        event,\n        mainWorkspace.getParentSvg(),\n        mainWorkspace.getInverseScreenCTM(),\n    );\n\n    // Gets where the visible workspace starts in relation to the workspace's parent svg element.\n    const absoluteMetrics = mainWorkspace\n        .getMetricsManager()\n        .getAbsoluteMetrics();\n\n    // In workspace coordinates 0,0 is where the visible workspace starts.\n    mouseXY.x -= absoluteMetrics.left;\n    mouseXY.y -= absoluteMetrics.top;\n\n    // Takes into account if the workspace is scrolled.\n    mouseXY.x -= mainWorkspace.scrollX;\n    mouseXY.y -= mainWorkspace.scrollY;\n\n    // Takes into account if the workspace is zoomed in or not.\n    mouseXY.x /= mainWorkspace.scale;\n    mouseXY.y /= mainWorkspace.scale;\n\n    mouseCoords.x = mouseXY.x;\n    mouseCoords.y = mouseXY.y;\n}\n\nfunction hotfixDomMutations(): void {\n    function hotfixBlock(block: BlockSvg): void {\n        //NOTE: Don't fix blocks that don't have state information or implement mutations properly\n        if (\n            !block.saveExtraState ||\n            !block.loadExtraState ||\n            (block.mutationToDom && block.domToMutation)\n        ) {\n            return;\n        }\n\n        //NOTE: Always replace this implementation, since it's not needed for backwards compatibility.\n        block.mutationToDom = function (): Element {\n            const mutation = BlocklyWrapper.Xml.createElement(\"mutation\");\n            mutation.setAttribute(\n                \"portal-extensions-state\",\n                JSON.stringify(this.saveExtraState()),\n            );\n\n            return mutation;\n        };\n\n        const originalDomToMutation = block.domToMutation;\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        block.domToMutation = function (mutation: Element): any {\n            const stateAttribute = mutation.getAttribute(\n                \"portal-extensions-state\",\n            );\n\n            if (stateAttribute) {\n                this.loadExtraState(JSON.parse(stateAttribute));\n            } else if (originalDomToMutation) {\n                // eslint-disable-next-line prefer-rest-params\n                originalDomToMutation.apply(this, arguments);\n            }\n        };\n    }\n\n    //NOTE: Fix the Block-classes\n    for (const block of BlocklyWrapper.Blocks.getAllClasses()) {\n        hotfixBlock(block.value);\n    }\n\n    //NOTE: Fix the Blocks that are already instanced\n    for (const block of BlocklyWrapper.Blocks.getAllInstances()) {\n        hotfixBlock(block.value);\n    }\n}\n\nexport default {};\n","let pasteTextFromClipboardImplementation: () => Promise<string> =\n    pasteTextFromClipboardDefault;\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet pasteTextFromClipboardFirefoxCallback = (_text: string): void => {\n    //Do nothing\n};\n\nexport function init(): void {\n    //NOTE: If readText is not available, we are going to assume this is Firefox.\n    if (navigator.clipboard.readText !== undefined) {\n        return;\n    }\n\n    pasteTextFromClipboardImplementation = pasteTextFromClipboardFirefox;\n\n    window.addEventListener(\n        \"bf2042-portal-extensions-paste\",\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        async function (message: any) {\n            pasteTextFromClipboardFirefoxCallback(message.detail);\n        },\n    );\n}\n\nasync function copyTextToClipboard(text: string): Promise<void> {\n    return await navigator.clipboard.writeText(text);\n}\n\nasync function copyBlobToClipboard(blobData: Blob): Promise<void> {\n    return await navigator.clipboard.write([\n        new ClipboardItem({ [blobData.type]: blobData }),\n    ]);\n}\n\nasync function pasteTextFromClipboard(): Promise<string> {\n    return await pasteTextFromClipboardImplementation();\n}\n\nasync function pasteTextFromClipboardDefault(): Promise<string> {\n    return await navigator.clipboard.readText();\n}\n\nasync function pasteTextFromClipboardFirefox(): Promise<string> {\n    // eslint-disable-next-line @typescript-eslint/typedef\n    return new Promise<string>((resolve, reject) => {\n        pasteTextFromClipboardFirefoxCallback = (clipboard: string): void => {\n            if (clipboard) {\n                resolve(clipboard);\n            } else {\n                reject();\n            }\n        };\n\n        const event: Event = new Event(\"bf2042-portal-extensions-paste\");\n        document.dispatchEvent(event);\n    });\n}\n\nfunction isCopyBlobToClipboardSupported(): boolean {\n    return window.ClipboardItem !== undefined;\n}\n\nfunction logError(message: string, error: Error): void {\n    console.log(`[ERROR] ${message}`, error);\n}\n\nfunction loadFromLocalStorage<T>(key: string): T {\n    const data: string = localStorage.getItem(key);\n\n    try {\n        if (typeof data === \"string\") {\n            return JSON.parse(data) as T;\n        }\n    } catch (e) {\n        //Do nothing\n    }\n\n    return {} as T;\n}\n\nfunction saveToLocalStorage<T>(key: string, data: T): void {\n    localStorage.setItem(key, JSON.stringify(data));\n}\n\nexport default {\n    copyTextToClipboard: copyTextToClipboard,\n    copyBlobToClipboard: copyBlobToClipboard,\n    pasteTextFromClipboard: pasteTextFromClipboard,\n    isCopyBlobToClipboardSupported: isCopyBlobToClipboardSupported,\n    loadFromLocalStorage: loadFromLocalStorage,\n    saveToLocalStorage: saveToLocalStorage,\n    logError: logError,\n};\n","import * as extensions from \"./Extensions\";\nimport * as plugins from \"./Plugins\";\nimport * as shared from \"./Shared\";\n\nBF2042Portal.Shared = shared.default;\nBF2042Portal.Plugins = plugins.default;\nBF2042Portal.Extensions = extensions.default;\n\nshared.init();\nextensions.init();\n"],"names":["BasePlugin","initData","baseUrl","manifest","relativeUrl","scope","options","menu","item","id","name","scopeType","plugins","init","data","loadPluginManager","pluginManager","loadPlugin","pluginData","plugin","scriptElement","e","_a","initializeWorkspace","getPlugin","Plugins","blocklyWrapper","blockly","blocklyTranslations","self","key","splitKeys","firstElement","index","event","rtl","workspace","block","xmlDom","BlocklyWrapper","blocklyConfig","mouseCoords","contextMenuStack","lastContextMenu","blockLookup","blockCategories","selectedBlocks","shiftKey","imageDataUrlCache","copyToClipboard","errorMessage","precondition","callback","blocks","getSelectedBlocks","xmlText","saveXml","pasteFromClipboard","loadXml","toggleComments","displayText","toggleType","commentText","i","toggleInputs","isInputInline","toggleCollapse","isCollapsed","collapseAllBlocks","expandAllBlocks","deleteModBlock","openDocumentation","documentationUrl","jumpToSubRoutine","subroutineName","foundBlocks","toggleDistractionFreeMode","toggleToolbox","exportBlocksWorkspace","exportBlocks","exportBlocksBlock","menuItems","exportToXml","exportToSvg","exportToPngAsFile","exportToPngOnClipboard","showContextMenuWithBack","dataUri","downloadFile","svgData","blocksToSvg","pngData","svgToData","blobData","convertImagesToDataURI","x","y","width","height","minX","minY","maxX","maxY","xy","boundingBox","clone","svg","css","el","style","svgAsXML","matches","match","url","dataUrl","resolve","reject","blob","reader","f","_","scale","dataType","canvas","context","img","fileData","fileName","linkElement","importBlocksFromFile","inputElement","fileReader","extension","loadData","loadJson","addBlock","entry","subOptions","i2","entry2","role","sortByText","a","b","separatorWorkspace","separator","separatorBlock","optionsWorkspace","createMenu","optionsBlock","subMenuOptions","subMenuItem","createSubMenuItem","registerMenu","registerItem","variablesXml","variables","domText","variableBlocks","objectType","variableName","v","variable","titleCase","value","s","getMouseCoords","cssFixes","hookContextMenu","hookBlockly","initializeBlocks","initializeDocumentEvents","initializeBlockly","pluginInit","styleElement","workspacePrototype","originalWorkspaceShowContextMenu","updateMouseCoords","blockPrototype","originalBlockShowContextMenu","originalShow","hotfixDomMutations","initializeWorkspaceEvents","contentMenuItem","optionsWorkspaceMenu","optionsBlockMenu","addBlockMenuItem","menuItem","itemId","menuId","blockDefinitions","getCategory","selectionLists","ignoreValueBlocks","element","existingCategory","deltaX","deltaY","activeBlock","selectedIndex","ignoreBlock","mainWorkspace","mouseXY","absoluteMetrics","hotfixBlock","mutation","originalDomToMutation","stateAttribute","Extensions","pasteTextFromClipboardImplementation","pasteTextFromClipboardDefault","pasteTextFromClipboardFirefoxCallback","_text","pasteTextFromClipboardFirefox","message","copyTextToClipboard","text","copyBlobToClipboard","pasteTextFromClipboard","clipboard","isCopyBlobToClipboardSupported","logError","error","loadFromLocalStorage","saveToLocalStorage","Shared","shared.default","plugins.default","extensions.default","shared.init","extensions.init"],"mappings":"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"}